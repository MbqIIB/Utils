<?xml version="1.0" encoding="utf-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
       http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.1.xsd">

    <!--  -->
    <bean class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
        <property name="location">
            <bean class="eu.trojanbug.spring.resource.WrapperResource">
                <constructor-arg index="0" ref="cortexConfig"/>
            </bean>
        </property>
        <property name="ignoreUnresolvablePlaceholders" value="true"/>
    </bean>

    <bean scope="singleton" id="cortexConfig" class="org.springframework.jndi.JndiObjectFactoryBean" >
        <property name="jndiName" value="url/CortexConfig.properties" />
        <property name="resourceRef" value="false" />
        <property name="defaultObject" value="classpath:CortexConfig.properties"/>
    </bean>


    <bean id="cortexWebServiceClient" class="com.fnis.xes.ifx.interfacepoint.cortex.CortexWebServiceClient">
        <property name="cortexWebServiceTemplate" ref="cortexWebServiceTemplate"/>
        <property name="cid" value="${cortex.cardApplication.attachment.cid}"/>
    </bean>

    <bean id="cortexWebServiceTemplate" class="com.fisglobal.emea.springframwork.ws.core.XpressWebServiceTemplate">
        <constructor-arg ref="cortexSoapMessageFactory"/>
        <constructor-arg ref="xpressWebServiceTemplateHttpClient"/>
        <property name="defaultUri" value="${cortex.defaultUri}"/>
    </bean>

    <!--
    <bean id="cortexWebServiceTemplate" class="org.springframework.ws.client.core.WebServiceTemplate">
        <constructor-arg ref="cortexSoapMessageFactory"/>
        <property name="defaultUri" value="${cortex.defaultUri}"/>
        <property name="messageSender" ref="cortexHttpSender"/>
    </bean>

    <bean id="cortexHttpSender" class="org.springframework.ws.transport.http.HttpComponentsMessageSender">
        <property name="connectionTimeout" value="${cortex.connectionTimeout}"/>
        <property name="readTimeout" value="${cortex.readTimeout}"/>
    </bean>
    -->


    <bean id="cortexSoapMessageFactory" class="org.springframework.ws.soap.axiom.AxiomSoapMessageFactory">
        <property name="soapVersion">
            <util:constant static-field="org.springframework.ws.soap.SoapVersion.SOAP_11"/>
        </property>
    </bean>

    <bean class="com.fnis.xes.ifx.interfacepoint.cortex.handler.StatusChangeCortexHandler" id="statusChangeCortexHandler">
        <property name="URL" value="${cortex.statusChange.defaultUri}"/>
    </bean>

    <bean class="com.fnis.xes.ifx.interfacepoint.cortex.handler.CardListEnquiryCortexHandler" id="cardListEnquiryCortexHandler">
        <property name="URL" value="${cortex.listInq.defaultUri}"/>
    </bean>

    <bean class="com.fnis.xes.ifx.interfacepoint.cortex.handler.CardLimitEnquiryCortexHandler" id="cardLimitEnquiryCortexHandler">
        <property name="URL" value="${cortex.limitInq.defaultUri}"/>
    </bean>

    <bean class="com.fnis.xes.ifx.interfacepoint.cortex.handler.ManagePinCortexHandler" id="managePinCortexHandler">
        <property name="URL" value="${cortex.managePin.defaultUri}"/>
    </bean>

    <bean class="com.fnis.xes.ifx.interfacepoint.cortex.handler.CardApplicationCortexHandler" id="cardApplicationCortexHandler">
        <property name="URL" value="${cortex.cardApplication.defaultUri}"/>
    </bean>

    <bean class="com.fisglobal.emea.xpress.service.errorhandlers.exceptions.cortex.CortexStatusExceptionHandler" name="cortexStatusExceptionHandler">
        <!-- "host warning", host_status_code=-1001, ifx_status_code=0 -->
        <property name="defaultStatusCode" value="-1001" />
        <property name="defaultSpName" value="com.fnf.xes.XES" />
        <property name="defaultSeverity" value="Info" />

        <!-- "bad data", host_status_code=100663386, ifx_status_code=200 -->
        <property name="errorStatusCode" value="100663386" />
        <property name="errorSpName" value="com.fnf.xes.XES" />
        <property name="errorSeverity" value="Error" />

        <property name="continueProcessing" value="false" />
    </bean>

    <!-- Cortex exception handlers -->
    <bean id="cortexExceptionHandlers" class="org.springframework.beans.factory.config.ListFactoryBean">
        <property name="sourceList" >
            <list>
                <ref bean="xboResponseSettingExceptionHandler" />
                <ref bean="noRecordsFoundExceptionHandler" />
                <ref bean="inputValidationExceptionHandler" />
                <!-- these are cortex specific exceptions -->
                <ref bean="cortexStatusExceptionHandler" />

                <ref bean="defaultExceptionHandler" />
            </list>
        </property>
    </bean>

    <bean id="cortexMessageIdProvider" class="org.springframework.beans.factory.config.MethodInvokingFactoryBean" scope="singleton">
        <property name="staticMethod" value="com.fnis.xes.services.adapter.cortex.utils.SimpleMessageIdProvider.getInstance"/>
    </bean>

</beans>
